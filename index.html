<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>voicedu.site ‚Äî Cyber IA ¬∑ TTS</title>
  <meta name="description" content="voicedu.site ‚Äî Generaci√≥n de voz con IA (texto‚Üívoz), estilo cyberIA ne√≥n. Backend en Vercel, descargas MP3/WAV y subida a CDN." />
  <meta name="theme-color" content="#00f5d4" />
  <style>
    :root{
      --bg:#0b1220; --card: rgba(255,255,255,0.03); --border: rgba(255,255,255,0.08);
      --txt:#d9e3f0; --muted:#9bb1c7; --neon:#00f5d4;
      --shadow: 0 10px 30px rgba(0,0,0,0.35); --radius:14px; --radius-xs:10px;
      --maxw:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Inter, Roboto, Arial;
      background: radial-gradient(1200px 800px at 10% -10%, rgba(0,245,212,0.07), transparent 40%),
                  radial-gradient(900px 600px at 110% 10%, rgba(87,113,255,0.07), transparent 40%),
                  linear-gradient(180deg, #0a0f1d, #0b1220);
    }
    .bg-anim{position:fixed; inset:0; z-index:-1; pointer-events:none}
    .glow{position:absolute; width:52vmin; height:52vmin; border-radius:50%; filter: blur(65px);
      opacity:.55; transform: translate(-50%,-50%);
      background: radial-gradient(circle at 50% 50%, var(--neon), transparent 60%); animation: float 12s ease-in-out infinite;}
    .glow.g2{left:88%; top:8%; background: radial-gradient(circle at 50% 50%, #6ea8ff, transparent 60%); animation-duration:14s}
    .glow.g3{left:18%; top:86%; background: radial-gradient(circle at 50% 50%, #8cffda, transparent 60%); animation-duration:16s}
    @keyframes float{0%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-48%,-52%) scale(1.12)}100%{transform:translate(-50%,-50%) scale(1)}}

    header{max-width:var(--maxw); margin:20px auto 12px; padding:0 16px; display:flex; gap:12px; align-items:flex-start; justify-content:space-between}
    .brand{display:flex; gap:10px; align-items:center}
    .logo{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(145deg, rgba(0,245,212,0.18), rgba(87,113,255,0.18)); border:1px solid var(--border); box-shadow:0 0 16px rgba(0,245,212,.25) inset,0 0 22px rgba(0,245,212,.1)}
    h1{margin:0;font-size:20px} h1 .n{color:var(--neon); text-shadow:0 0 10px rgba(0,245,212,.55)}
    .lead{margin:2px 0 0; color:var(--muted); font-size:13px}

    .api-panel{display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end}
    select,input,textarea{background:rgba(0,0,0,.45); color:var(--txt); border:1px solid var(--border); border-radius:var(--radius-xs); padding:10px 12px; outline:none}
    input::placeholder{color:#89a; opacity:.7}
    .api-input{display:flex; gap:8px; align-items:center; padding:10px; border:1px solid var(--border); background:var(--card); border-radius:var(--radius);}

    .btn{padding:10px 14px; border-radius: var(--radius-xs); border:1px solid var(--border); background: rgba(255,255,255,0.03); color:var(--txt); cursor:pointer; transition:.2s ease; box-shadow:var(--shadow)}
    .btn:hover{transform:translateY(-1px); background: rgba(255,255,255,0.06)}
    .btn[disabled]{opacity:.55; cursor:not-allowed; box-shadow:none}
    .btn.primary{background: linear-gradient(180deg, rgba(0,245,212,0.18), rgba(0,245,212,0.08)); border-color: rgba(0,245,212,0.35);}
    .btn.primary:hover{background: linear-gradient(180deg, rgba(0,245,212,0.26), rgba(0,245,212,0.12));}

    main{max-width:var(--maxw); margin: 6px auto 40px; padding:0 16px; display:grid; grid-template-columns: 1.2fr .9fr; gap:16px}
    .card{background: var(--card); border:1px solid var(--border); border-radius: var(--radius); padding:14px; box-shadow: var(--shadow)}
    .card h3{margin:0 0 10px; font-size:16px}

    .grid{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px}
    .voice-item{background: rgba(255,255,255,0.02); border:1px solid var(--border); border-radius:12px; padding:10px; display:flex; gap:10px; align-items:center; cursor:pointer}
    .voice-item:active{transform: scale(.99)}
    .voice-item:hover{border-color: rgba(0,245,212,0.35); background: rgba(0,245,212,0.05)}
    .avatar{width:40px;height:40px;border-radius:12px;background:linear-gradient(145deg, rgba(255,255,255,0.05), rgba(0,0,0,0.25)); display:grid; place-items:center; color:#8aa}
    .muted{color:var(--muted)}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .small{font-size:12px; color:var(--muted)}
    textarea{width:100%; min-height:120px; resize:vertical}
    .empty{border:1px dashed rgba(255,255,255,0.18); border-radius:12px; padding:16px; text-align:center; color:var(--muted)}

    /* --- Mobile tweaks --- */
    @media (max-width: 980px){
      header{flex-direction:column; align-items:flex-start}
      .api-panel{width:100%}
      .api-input{width:100%}
      main{grid-template-columns: 1fr; gap:14px}
      .grid{grid-template-columns: repeat(2, 1fr)}
      .btn{flex:1} /* buttons full width in rows */
    }
    @media (max-width: 480px){
      .grid{grid-template-columns: 1fr}
      h1{font-size:18px}
      .lead{font-size:12px}
      .api-input input{min-width:0; width:100%}
    }

    footer{max-width:var(--maxw);margin:10px auto 60px; padding:0 16px; color:var(--muted); font-size:12px}
    a{color:var(--neon); text-decoration:none}
  </style>
</head>
<body>
  <div class="bg-anim"><div class="glow" style="left:12%; top:0%"></div><div class="glow g2"></div><div class="glow g3"></div></div>

  <header>
    <div class="brand">
      <div class="logo">üéõÔ∏è</div>
      <div>
        <h1><span class="n">Voice</span>Du ‚Äî voicedu.site</h1>
        <p class="lead">Generaci√≥n de voz (TTS) ‚Ä¢ interfaz cyberIA ne√≥n ‚Ä¢ backend en Vercel</p>
      </div>
    </div>
    <div class="api-panel">
      <select id="siteLang" title="Idioma del sitio"><option value="es">ES</option><option value="en">EN</option></select>
      <div class="api-input">
        <input id="apiBaseInput" type="url" placeholder="https://tuapp.vercel.app/api" style="min-width:260px">
        <button id="saveApi" class="btn primary">Guardar</button>
      </div>
    </div>
  </header>

  <main>
    <section>
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <h3 id="filtersTitle">Filtros</h3>
          <div class="row">
            <select id="tagFilter">
              <option value="">Todas</option><option value="dibujos">Dibujos</option><option value="cine">Cine</option>
              <option value="deportes">Deportes</option><option value="actores">Actores</option><option value="politicos">Pol√≠ticos</option>
            </select>
            <select id="langFilter">
              <option value="">Todos idiomas</option><option value="spanish">Spanish</option><option value="english">English</option>
            </select>
            <select id="stateFilter" title="Estados"><option value="">Estados</option><option value="ready">Ready</option><option value="processing">Processing</option></select>
            <button id="refreshBtn" class="btn">Refrescar</button>
          </div>
        </div>
      </div>

      <div class="card" id="voicesCard">
        <div id="voicesWrap"><div id="noVoices" class="empty">Cargando voces...</div></div>
      </div>

      <div class="card">
        <h3 id="txtTitle">Texto a sintetizar</h3>
        <textarea id="textInput" spellcheck="true">Hola, esto es una prueba en voicedu.site ‚Äî estilo cyberIA ne√≥n.</textarea>
        <div class="row" style="margin-top:10px;">
          <button id="generateBtn" class="btn primary">Generar voz</button>
          <button id="downloadBtn" class="btn" disabled>Descargar</button>
          <button id="cdnBtn" class="btn" disabled>Guardar en CDN</button>
          <span id="status" class="small"></span>
        </div>
        <div id="playerWrap" style="margin-top:10px;"></div>
      </div>
    </section>

    <aside>
      <div class="card">
        <h3 id="selTitle">Voz seleccionada</h3>
        <div class="row">
          <div class="avatar">üë§</div>
          <div><div id="selName"><strong>Nombre</strong></div><div id="selLang" class="small muted">Idioma</div></div>
        </div>
        <div style="margin-top:10px;"><button id="sampleBtn" class="btn">‚ñ∂ Escuchar muestra</button></div>
      </div>
      <div class="card">
        <h3 id="paramsTitle">Par√°metros</h3>
        <div class="row" style="align-items:center"><span class="small" id="formatLabel">Formato:</span>
          <select id="formatSel"><option value="mp3">MP3</option><option value="wav">WAV</option></select>
        </div>
        <div style="margin-top:12px" class="small note">Pon tu URL de Vercel /api arriba. Ej.: https://mi-app.vercel.app/api</div>
      </div>
    </aside>
  </main>

  <footer>¬© 2025 <strong>voicedu.site</strong> ‚Äî demo ¬∑ Configura <code>UBERDUCK_API_KEY</code> / <code>UBERDUCK_API_SECRET</code> en Vercel.</footer>

  <script>
    // i18n simple
    const i18n={es:{filters:'Filtros',txt:'Texto a sintetizar',selected:'Voz seleccionada',params:'Par√°metros',format:'Formato:',loadVoices:'Cargando voces...',noVoices:'No se encontraron voces.',listen:'‚ñ∂ Escuchar muestra',gen:'Generar voz',dl:'Descargar',cdn:'Guardar en CDN',tip:'Pon tu URL de Vercel /api arriba. Ej.: https://mi-app.vercel.app/api'},en:{filters:'Filters',txt:'Text to synthesize',selected:'Selected voice',params:'Parameters',format:'Format:',loadVoices:'Loading voices...',noVoices:'No voices found.',listen:'‚ñ∂ Play sample',gen:'Generate voice',dl:'Download',cdn:'Save to CDN',tip:'Set your Vercel /api URL above. e.g. https://my-app.vercel.app/api'}};
    const el=(q)=>document.querySelector(q);
    const siteLangSel=el('#siteLang'); const filtersTitle=el('#filtersTitle'); const txtTitle=el('#txtTitle'); const selTitle=el('#selTitle'); const paramsTitle=el('#paramsTitle'); const formatLabel=el('#formatLabel'); const note=document.querySelector('.note');
    const generateBtn=el('#generateBtn'), downloadBtn=el('#downloadBtn'), cdnBtn=el('#cdnBtn'), sampleBtn=el('#sampleBtn'), statusSpan=el('#status'), voicesWrap=el('#voicesWrap'), playerWrap=el('#playerWrap'), selName=el('#selName'), selLang=el('#selLang'), apiBaseInput=el('#apiBaseInput'), saveApiBtn=el('#saveApi');

    let apiBase=localStorage.getItem('voicedu_api')||''; if(apiBase) apiBaseInput.value=apiBase.replace(/\/api$/,'');
    let currentVoice=null, lastAudioUrl=null;
    function t(k){const lang=siteLangSel.value||'es'; return (i18n[lang]&&i18n[lang][k])||i18n.es[k]||k;}
    function applyLang(){filtersTitle.textContent=t('filters'); txtTitle.textContent=t('txt'); selTitle.textContent=t('selected'); paramsTitle.textContent=t('params'); formatLabel.textContent=t('format'); note.textContent=t('tip'); generateBtn.textContent=t('gen'); downloadBtn.textContent=t('dl'); cdnBtn.textContent=t('cdn'); sampleBtn.textContent=t('listen'); const nv=el('#noVoices'); if(nv) nv.textContent=t('loadVoices');}
    siteLangSel.value=localStorage.getItem('voicedu_lang')||'es'; applyLang(); siteLangSel.addEventListener('change',()=>{localStorage.setItem('voicedu_lang',siteLangSel.value); applyLang();});
    saveApiBtn.addEventListener('click',()=>{const base=apiBaseInput.value.trim().replace(/\/+$/,''); apiBase=base+'/api'; if(base.startsWith('http')){localStorage.setItem('voicedu_api',apiBase); statusSpan.textContent='API guardada.'; loadVoices();}else alert('Ingresa una URL v√°lida.');});

    const tagMap={dibujos:'character',cine:'entertainment',deportes:'celebrity',actores:'celebrity',politicos:'celebrity'};
    const langMap={english:'english',spanish:'spanish',en:'english',es:'spanish'};

    async function loadVoices(){
      voicesWrap.innerHTML='<div id="noVoices" class="empty">'+t('loadVoices')+'</div>';
      try{
        const params=new URLSearchParams();
        const tag=el('#tagFilter').value, language=el('#langFilter').value, state=el('#stateFilter').value;
        if(tag) params.set('tag', tagMap[tag]||tag); if(language) params.set('language', langMap[language]||language); if(state) params.set('state', state);
        if(!apiBase) return;
        const res=await fetch(`${apiBase}/voices?${params.toString()}`);
        if(!res.ok) throw new Error('Error voces');
        const data=await res.json();
        renderVoices(Array.isArray(data)?data:[]);
      }catch(e){console.error(e); voicesWrap.innerHTML='<div class="empty">'+t('noVoices')+'</div>';}
    }
    function renderVoices(list){
      if(!list.length){voicesWrap.innerHTML='<div class="empty">'+t('noVoices')+'</div>'; return;}
      const grid=document.createElement('div'); grid.className='grid';
      list.forEach(v=>{const item=document.createElement('div'); item.className='voice-item'; item.innerHTML=`<div class="avatar">üéôÔ∏è</div><div style="flex:1"><div><strong>${v.name||'Nombre'}</strong></div><div class="small muted">${v.language||'Idioma'}</div></div>`; item.addEventListener('click',()=>selectVoice(v)); grid.appendChild(item);});
      voicesWrap.innerHTML=''; voicesWrap.appendChild(grid);
    }
    function selectVoice(v){currentVoice=v; selName.innerHTML='<strong>'+(v.name||'Nombre')+'</strong>'; selLang.textContent=v.language||'Idioma';}
    el('#refreshBtn').addEventListener('click', loadVoices);
    sampleBtn.addEventListener('click', ()=>{if(!currentVoice||!currentVoice.sampleUrl) return alert('Selecciona una voz con muestra.'); playUrl(currentVoice.sampleUrl);});

    function playUrl(url){lastAudioUrl=url; playerWrap.innerHTML=''; const audio=document.createElement('audio'); audio.controls=true; audio.src=url; audio.style.width='100%'; playerWrap.appendChild(audio); downloadBtn.disabled=false; cdnBtn.disabled=false;}
    async function generateTTS(){
      if(!apiBase) return alert('Configura la URL de API (Vercel).'); if(!currentVoice) return alert('Selecciona una voz.');
      const text=el('#textInput').value.trim(); if(!text) return alert('Escribe un texto.'); const format=el('#formatSel').value||'mp3'; statusSpan.textContent='Generando...';
      try{
        const res=await fetch(`${apiBase}/tts`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text,voiceId:currentVoice.id||currentVoice.name,lang:(siteLangSel.value==='en'?'en':'es'),format})});
        if(!res.ok) throw new Error(await res.text()); const data=await res.json(); const mime=data.mimeType||(format==='wav'?'audio/wav':'audio/mpeg'); const src='data:'+mime+';base64,'+data.audioBase64; playUrl(src); statusSpan.textContent='Listo.';
      }catch(err){console.error(err); statusSpan.textContent='Error al generar.'; alert('Error TTS: '+(err.message||err));}
    }
    generateBtn.addEventListener('click', generateTTS);
    downloadBtn.addEventListener('click', ()=>{if(!lastAudioUrl) return; const a=document.createElement('a'); a.href=lastAudioUrl; const ext=(el('#formatSel').value||'mp3'); a.download='voicedu-'+Date.now()+'.'+ext; document.body.appendChild(a); a.click(); a.remove();});

    async function blobFromUrl(url){const res=await fetch(url); return await res.blob();}
    function blobToBase64(blob){return new Promise((resolve,reject)=>{const r=new FileReader(); r.onloadend=()=>resolve(r.result.split(',')[1]); r.onerror=reject; r.readAsDataURL(blob);});}
    el('#cdnBtn').addEventListener('click', async ()=>{
      if(!lastAudioUrl) return alert('Genera un audio primero.'); if(!apiBase) return alert('Configura la URL de API.');
      try{statusSpan.textContent='Subiendo a CDN...'; const blob=await blobFromUrl(lastAudioUrl); const base64=await blobToBase64(blob); const ext=(blob.type==='audio/wav'?'wav':'mp3'); const filename='voicedu-'+Date.now()+'.'+ext;
        const res=await fetch(`${apiBase}/upload`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({fileBase64:base64,filename,contentType:blob.type,metadata:{lang:siteLangSel.value}})});
        if(!res.ok) throw new Error(await res.text()); const data=await res.json(); statusSpan.textContent='CDN: '+(data.publicUrl||'ok'); if(data.publicUrl){const a=document.createElement('a'); a.href=data.publicUrl; a.target='_blank'; a.textContent='Abrir en CDN'; a.style.marginLeft='8px'; playerWrap.appendChild(a);}
      }catch(err){console.error(err); statusSpan.textContent='Error CDN'; alert('Error al subir a CDN: '+(err.message||err));}
    });

    if(apiBase){loadVoices();}
  </script>
</body>
</html>
